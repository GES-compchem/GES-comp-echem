---
jupytext:
  formats: md:myst
  text_representation:
    extension: .md
    format_name: myst
kernelspec:
  display_name: Python 3
  language: python
  name: python3
---

(Guide-systems)=
# Defining molecular systems

When running computational chemistry numerical simulations, you need to define two things: the system under study, and the type of calculation to run on it. For the former, you can use the `compechem.systems` submodule.

The `compechem.systems` submodule contains the following classes, used to collect and store information about the system of interest:

* `System`: generic system object, such as a single molecule.
* `Ensemble`: ensemble object, intended as a collection of closely related `System` objects. For example, the ensemble of conformers generated by the corresponding **CREST** routine.

The individual classes can be imported as follows:

```python
from compechem.systems import System
from compechem.systems import Ensemble
```

In this section of the user guide, we will show you how to define molecular systems using the aforementioned classes.

---

## Single systems

A `System` object is defined as a molecular system, containing one or more individual molecules, and is initialized by providing a molecular structure via a `.xyz` file:

```python
from compechem.systems import System
my_mol = System("path/to/xyz/water.xyz")
```

Optionally, the following parameters can be provided (if not provided, some default values are set):

* `charge`: total charge of the system. Default: 0
* `spin`: total spin multiplicity of the system (2S+1, where S is the total spin quantum number). Default: 1 (singlet)
* `box_side`: (for periodic systems only), length of the simulation box (in Å)

Example of a periodic system of side 18.27 Å containing a cation radical:
```python
from compechem.systems import System
my_mol = System(
    "path/to/xyz/water.xyz", 
    charge=1, 
    spin=2,
    box_side=18.27,
)
```

To get a list of all the available properties, please refer to the [API](API-systems). 

For a quick look at the main properties of a `System`, you can simply ask to print the corresponding variable:

```python
print(my_system)
```

```{code-cell} python
:tags: ["remove-input"]
from compechem.systems import System
water = System("../example_files/water.xyz")
print(water)
```

---

## Ensembles

An `Ensemble` object is defined as a collection of related `Systems`, for example the collection of lowest-energy conformers generated by [CREST](API-wrappers-crest). To initialise an `Ensemble` object you need to provide an `iterable` (such as a list) yielding `System` objects:

```python
from compechem.systems import System
from compechem.systems import Ensemble

my_mol1 = System("path/to/xyz/my_mol1.xyz")
my_mol2 = System("path/to/xyz/my_mol2.xyz")
my_mol3 = System("path/to/xyz/my_mol3.xyz")

my_list = [my_mol1, my_mol2, my_mol3]

my_ens = Ensemble(my_list)
```

To get a list of all the available properties, please refer to the [API](API-systems).

---

## Saving/Loading System objects

It is possible to save/load `System` objects to/from `.json` files. To save a `System` object, dumping all the information currently stored in it after the undergone calculations (structure, charge, spin multiplicity, energies, frequencies, etc...) use the `system.save_json()` function and specify the path where you want to store the file:

```python
from compechem.systems import System

mol = System("water.xyz")

... calculations ...

mol.save_json("water.json")
```

Then, you can load a previously saved `System` by passing the `.json` file path instead of a `.xyz` file:

```python
from compechem.systems import System

mol = System("water.json")
print(mol)
```

```{code-cell} python
:tags: ["remove-input"]
from compechem.systems import System
water = System("../example_files/water.json")
print(water)
```

<!-- ## Molecular Dynamics Trajectories

:::{admonition} Note
:class: info
This is still very much WIP! Expect the following content to possibly be changed significantly with future updates!
:::

An `MDTrajectory` object is conceptually an `Ensemble` generated by a Molecular Dynamics (MD) trajectory. Currently, only [DFTB+](API-wrappers-dftbplus) MD are supported. `MDTrajectory` objects are initialised by providing the path `prefix` to the `<prefix>_md.out` file storing the energy information and `<prefix>_geo_end.xyz` file storing the coordinate information, and the level of theory at which the DFTB+ simulation was ran:

```python
from compechem.systems import MDTrajectory

# note, the following files must exist:
# path/to/xyz/my_traj_md.out
# path/to/xyz/my_traj_geo_end.xyz
my_traj = MDTrajectory("path/to/xyz/my_traj", "gfn2")
```

The primary intended use for this class is as an on-the-fly generator of `System` objects corresponding to the requested frame of the MD simulation. 

Examples:

* Extract the last frame of the MD simulation as a System object:
```python
last_frame = my_traj[-1]
```
* Cycle over all frames and export the corresponding .xyz files:
```python
for frame in my_traj:
    frame.write_xyz(frame.name)
```

Note: individual "frames" are automatically internally renamed according to the corresponding step/index of the MD simulation.  -->